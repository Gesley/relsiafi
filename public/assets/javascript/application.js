var application=angular.module("application",["ngRoute","ngResource","ngAnimate","ngSanitize","ngCookies","ui.bootstrap","ui.mask","angular-loading-bar","flash","pascalprecht.translate"]);!function(e){"use strict";e.run(["$rootScope","$location","$cookies","Autenticacao",function(e,t,o,a){e.$on("$locationChangeStart",function(a,r,i){e.autenticacao=o.getObject("autenticacao"),o.getObject("autenticacao")||t.path("login")})}])}(application),function(e){"use strict";e.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,o){o.interceptors.push("SessionCheck"),e.when("/credencial",{templateUrl:"credencial",controller:"IndexCredencialController"}).when("/credencial/create",{templateUrl:"credencial/create",controller:"CreateCredencialController"}).when("/credencial/edit/:id",{templateUrl:"credencial/edit",controller:"EditCredencialController"}).when("/extracao",{templateUrl:"extracao",controller:"IndexExtracaoController"}).when("/extracao/create",{templateUrl:"extracao/create",controller:"CreateExtracaoController"}).when("/extracao/edit/:id",{templateUrl:"extracao/edit",controller:"EditExtracaoController"}).when("/tipo_arquivo",{templateUrl:"tipo_arquivo",controller:"IndexTipoArquivoController"}).when("/tipo_arquivo/create",{templateUrl:"tipo_arquivo/create",controller:"CreateTipoArquivoController"}).when("/tipo_arquivo/edit/:id",{templateUrl:"tipo_arquivo/edit",controller:"EditTipoArquivoController"}).when("/auditoria",{templateUrl:"auditoria",controller:"IndexAuditoriaController"}).when("/relatorio",{templateUrl:"relatorio",controller:"IndexRelatorioController"}).when("/login",{templateUrl:"layout/login",controller:"LoginController"}).when("/logout",{templateUrl:"layout/login",controller:"LogoutController"}).otherwise({redirectTo:"/login"}),t.hashPrefix("")}])}(application),function(e){"use strict";e.filter("dateRange",["$filter",function(e){return function(e,t,o,a){var r=[];return angular.forEach(e,function(e){if(null===e[t])return!1;var i=new Date(e[t]);i.setHours(0),i.setMinutes(0),i.setSeconds(0),angular.isUndefined(o)&&angular.isUndefined(a)?r.push(e):angular.isDefined(o)&&angular.isUndefined(a)?(o=new Date(o).getTime(),i>=o&&r.push(e)):(o=new Date(o).getTime(),a=new Date(a).getTime(),i>=o&&a>=i&&r.push(e))}),r}}])}(application),function(e){"use strict";e.factory("Auditoria",["$resource",function(e){return e("/api/auditoria")}])}(application),function(e){"use strict";e.factory("Autenticacao",["$http","$location","$rootScope","$cookies","FlashFactory",function(e,t,o,a,r){var i=function(o){e.post("/login",o).then(function(e){"success"===e.data.type?(r.trigger(e.data),t.path("relatorio")):r.trigger(e.data)})},n=function(){return e.get("/login/logout").then(function(e){r.trigger(e.data),delete o.autenticacao})},c=function(){return e.get("/login/autenticacao")};return{login:i,logout:n,getAutorizacao:c}}])}(application),function(e){"use strict";e.factory("Credencial",["$resource",function(e){return e("/api/credencial/:id_credencial",{id_credencial:"@id_credencial"},{update:{method:"PUT"},"delete":{method:"DELETE"}})}])}(application),function(e){"use strict";e.factory("ExecucaoStatus",["$resource",function(e){return e("/api/execucao_status")}])}(application),function(e){"use strict";e.factory("Extracao",["$resource",function(e){return e("/api/extracao/:id_extracao",{id_extracao:"@id_extracao"},{update:{method:"PUT"},"delete":{method:"DELETE"}})}])}(application),function(e){"use strict";e.factory("FlashFactory",["$location","Flash",function(e,t){var o=function(o){if(t.create(o.type,o.message,"customAlert"),"success"===o.type){var a=/(\/.*?\/)/gi;e.path(e.path().match(a))}};return{trigger:o}}])}(application),function(e){"use strict";e.factory("LDAP",["$resource",function(e){return e("/api/ldap")}])}(application),function(e){"use strict";e.factory("Localizacao",["$resource",function(e){return e("/api/localizacao/:id_localizacao",{id_localizacao:"@id_localizacao"})}])}(application),function(e){"use strict";e.factory("ModalFactory",["$modal",function(e){var t=function(t){if(angular.isString(t.type))switch(t.type){case"confirmation":t.template="/layout/modal-with-confirmation";break;case"content":t.template="/layout/modal-content"}var o=e.open({animation:!0,controller:"ModalInstanceController",templateUrl:t.template,size:t.size,resolve:{options:function(){return t}}});return o};return{trigger:t}}])}(application),function(e){"use strict";e.factory("Relatorio",["$locale","$http",function(e,t){var o=function(){return new Date(2015,8)},a=function(){return new Date},r=function(){for(var t=e.DATETIME_FORMATS.MONTH,r=[],i=o().getFullYear(),n=a().getFullYear();n>=i;)angular.forEach(t,function(e,t){e=e.charAt(0).toUpperCase()+e.slice(1),i==o().getFullYear()?t>=o().getMonth()&&t<=a().getMonth()&&r.push({month:{number:t+1,desc:e},year:i}):r.push({month:{number:t+1,desc:e},year:i})}),i++;return r},i=function(e){t.post("/relatorio",e,{cache:!1,responseType:"arraybuffer"}).then(function(t){if(1==e.id_formato)var o={type:"application/pdf"};else if(2==e.id_formato)var o={type:"application/vnd.ms-excel"};var a=new Blob(["\ufeff",t.data],o),r=URL.createObjectURL(a);window.open(r)})};return{startDate:o,limitDate:a,dateRange:r,generate:i}}])}(application),function(e){"use strict";e.factory("SessionCheck",["$q","$location","FlashFactory",function(e,t,o){var a=function(a){return 401===a.status&&(o.trigger({type:"danger",message:"Por favor, efetue o login."}),t.path("/")),e.reject(a)};return{responseError:a}}])}(application),function(e){"use strict";e.factory("TipoArquivo",["$resource",function(e){return e("/api/tipo_arquivo/:id_tipo_arquivo",{id_tipo_arquivo:"@id_tipo_arquivo"},{update:{method:"PUT"},"delete":{method:"DELETE"}})}])}(application),function(e){"use strict";e.controller("IndexAuditoriaController",["$scope","$filter","TipoArquivo","Auditoria","ExecucaoStatus","FlashFactory",function(e,t,o,a,r,i){e.startDate=new Date(2015,8),e.limitDate=new Date,o.query(function(t){e.tiposArquivo=t}),r.query(function(t){e.execucao_status=t}),a.query(function(t){e.auditorias=t})}])}(application),function(e){"use strict";e.controller("IndexCredencialController",["$scope","$location","Credencial","FlashFactory","ModalFactory",function(e,t,o,a,r){e.updateCredenciais=function(){o.query(function(t){e.credenciais=t})},e.updateCredenciais(),e.activate=function(t){var i=!1;if(e.updateRemotely=function(){var r=o.get({},{id_credencial:t.id_credencial});r.st_ativo="A",r.$update().then(function(t){e.updateCredenciais(),a.trigger(t)})},angular.forEach(e.credenciais,function(e){"A"===e.st_ativo&&(i=!0)}),i){var n={title:"Ativar credencial?",size:"sm",type:"confirmation",question:"Ativar a credencial desativará a credencial usada atualmente. Deseja realmente proceder com a operação?"};r.trigger(n).result.then(function(){e.updateRemotely()})}else e.updateRemotely()},e.edit=function(e){t.path("/credencial/edit/"+e.id_credencial)},e["delete"]=function(t){if("A"===t.st_ativo)a.trigger({type:"error",message:"Não é possível remover uma credencial ativa!"});else{var i={title:"Remover credencial?",size:"sm",type:"confirmation",question:"Deseja realmente remover esta credencial?"};r.trigger(i).result.then(function(){var r=o.get({},{id_credencial:t.id_credencial});r.st_deletado="S",r.$remove().then(function(t){e.updateCredenciais(),a.trigger(t)})})}}}]).controller("CreateCredencialController",["$scope","$location","Credencial","LDAP","FlashFactory",function(e,t,o,a,r){a.query(function(t){e.ldapUsers=t}),e.onSelectedUserChange=function(){e.selectedUser=e.credencial.nm_usuario,angular.forEach(e.ldapUsers,function(t){t.username===e.selectedUser&&(e.credencial.ds_email=t.email,e.credencial.ds_nome=t.name)}),e.credencial.nr_cpf=null,e.credencial.ds_senha=null},e.create=function(){o.save(e.credencial).$promise.then(function(e){r.trigger(e)},function(e){r.trigger(e)})},e.cancelar=function(e){t.path("/credencial")}}]).controller("EditCredencialController",["$scope","$location","$routeParams","Credencial","FlashFactory",function(e,t,o,a,r){var i=o.id;a.get({id_credencial:i},function(t){e.credencial=t,e.credencial.nr_cpf=null,e.credencial.ds_senha=null}),e.atualizar=function(){if(e.EditCredencialForm.$dirty){var t=a.get({},{id_credencial:i});angular.forEach(["ds_email","nr_cpf","ds_senha"],function(o){e.EditCredencialForm[o].$dirty&&(t[o]=e.credencial[o])}),t.$update().then(function(e){r.trigger(e)})}else r.trigger({type:"info",message:"Antes de atualizar é necessário que o formulário seja preenchido"})},e.cancelar=function(e){t.path("/credencial")}}])}(application),function(e){"use strict";e.controller("IndexExtracaoController",["$scope","$location","Extracao","FlashFactory","ModalFactory",function(e,t,o,a,r){e.updateExtracoes=function(){o.query(function(t){e.extracoes=t})},e.updateExtracoes(),e.edit=function(e){t.path("/extracao/edit/"+e.id_extracao)},e["delete"]=function(t){var i={title:"Remover extração?",type:"confirmation",size:"sm",question:"Deseja realmente remover esta extração?"};r.trigger(i).result.then(function(){var r=o.get({},{id_extracao:t.id_extracao});r.st_ativo="I",r.$remove().then(function(t){e.updateExtracoes(),a.trigger(t)})})}}]).controller("CreateExtracaoController",["$scope","$location","Extracao","FlashFactory",function(e,t,o,a){e.extracao={},e.create=function(){e.extracao.sg_extracao=e.extracao.nm_extracao.substring(6,8),o.save(e.extracao).$promise.then(function(e){a.trigger(e)},function(e){a.trigger(e)})},e.cancelar=function(e){t.path("/extracao")}}]).controller("EditExtracaoController",["$scope","$location","$routeParams","Extracao","FlashFactory",function(e,t,o,a,r){var i=o.id;a.get({id_extracao:i},function(t){e.extracao=t}),e.atualizar=function(){e.extracao.sg_extracao=e.extracao.nm_extracao.substring(6,8);var t=a.get({},{id_extracao:e.extracao.id_extracao});t.sg_extracao=e.extracao.sg_extracao,t.nm_extracao=e.extracao.nm_extracao,t.ds_extracao=e.extracao.ds_extracao,t.st_ativo=e.extracao.st_ativo,t.$update().then(function(e){r.trigger(e)},function(e){r.trigger({type:"info",message:"Antes de atualizar é necessário que o formulário seja preenchido"})})},e.cancelar=function(e){t.path("/extracao")}}])}(application),function(e){"use strict";e.controller("LoginController",["$scope","$location","$rootScope","Autenticacao",function(e,t,o,a){e.executar=function(){a.login(e.autenticacao)}}]).controller("LogoutController",["Autenticacao",function(e){e.logout()}])}(application),function(e){"use strict";e.controller("ModalInstanceController",["$scope","$modalInstance","options",function(e,t,o){e.title=o.title,e.question=o.question,e.content=o.content,e.confirmar=function(){t.close()},e.cancelar=function(){t.dismiss("cancel")}}])}(application),function(e){"use strict";e.controller("IndexRelatorioController",["$scope","Relatorio",function(e,t){e.startDate=t.startDate(),e.limitDate=t.limitDate(),e.dateRange=t.dateRange(),e.formatos=[{id:1,desc:"PDF(Portable Document Format)"},{id:2,desc:"Planilha Eletrônica(Excel)"}],e.relatorios=[{id:1,desc:"Relatório extração de dados SIAFI operacional"},{id:2,desc:"Relatório Prestação de Contas – Extração dos dados SIAFI Operacional"},{id:3,desc:"Relatório Consolidado das Extrações de dados SIAFI Operacional"},{id:4,desc:"Relatório da Extração de Carga Incremental – SIAFI Operacional"},{id:5,desc:"Relatório Demonstrativo de Faturamento – Ministério da Integração Nacional"}],e.generate=function(){t.generate(e.relatorio)}}])}(application),function(e){"use strict";e.controller("IndexTipoArquivoController",["$scope","$location","TipoArquivo","Localizacao","FlashFactory","ModalFactory",function(e,t,o,a,r,i){a.query(function(t){e.localizacoes=t}),e.updateTipoArquivos=function(){o.query(function(t){e.tiposArquivo=t})},e.edit=function(e){t.path("/tipo_arquivo/edit/"+e.id_tipo_arquivo)},e["delete"]=function(t){var a={title:"Remover Tipo de Arquivo?",type:"confirmation",size:"sm",question:"Deseja realmente remover este Tipo de Arquivo?"};i.trigger(a).result.then(function(){var a=o.get({},{id_tipo_arquivo:t.id_tipo_arquivo});a.$remove().then(function(t){e.updateTipoArquivos(),r.trigger(t)})})},e.updateTipoArquivos()}]).controller("CreateTipoArquivoController",["$scope","$location","$http","Localizacao","Extracao","TipoArquivo","FlashFactory","ModalFactory",function(e,t,o,a,r,i,n,c){e.tipoArquivo={},a.query(function(t){e.localizacoes=t}),r.query(function(t){e.extracoes=t}),e.create=function(t){i.save(e.tipoArquivo).$promise.then(function(e){n.trigger(e)},function(e){n.trigger(e)})},e.cancelar=function(){t.path("/tipo_arquivo")},e.regexHelp=function(){o.get("/tipo_arquivo/regex-help").then(function(e){c.trigger({title:"Ajuda",type:"content",size:"lg",content:e.data})})}}]).controller("EditTipoArquivoController",["$scope","$location","$http","$routeParams","TipoArquivo","Localizacao","Extracao","FlashFactory","ModalFactory",function(e,t,o,a,r,i,n,c,l){var u=a.id;r.get({id_tipo_arquivo:u},function(t){e.tipoArquivo=t}),i.query(function(t){e.localizacoes=t}),n.query(function(t){e.extracoes=t}),e.update=function(){var t=r.get({id_tipo_arquivo:e.tipoArquivo.id_tipo_arquivo},function(){t.id_extracao=e.tipoArquivo.id_extracao,t.id_localizacao=e.tipoArquivo.id_localizacao,t.sg_tipo_arquivo=e.tipoArquivo.sg_tipo_arquivo,t.nm_tipo_arquivo=e.tipoArquivo.nm_tipo_arquivo,t.ds_expressao_regular=e.tipoArquivo.ds_expressao_regular,t.$update().then(function(e){c.trigger(e)})})},e.regexHelp=function(){o.get("/tipo_arquivo/regex-help").then(function(e){l.trigger({title:"Ajuda",type:"content",size:"lg",content:e.data})})},e.cancelar=function(){t.path("/tipo_arquivo")}}])}(application);